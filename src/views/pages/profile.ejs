<%- include('../partials/header') %>

    <div class="max-w-2xl mx-auto mt-10">
        <div class="bg-slate-800 rounded-xl p-8 border border-slate-700 shadow-2xl relative overflow-hidden">

            <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-blue-600 to-purple-600 opacity-20">
            </div>

            <div class="relative flex flex-col md:flex-row items-center gap-8">
                <div class="w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center text-4xl font-bold text-blue-400 border-4 border-slate-800 shadow-xl"
                    id="avatar">
                    ?
                </div>

                <div class="text-center md:text-left flex-1">
                    <h1 class="text-3xl font-bold text-white mb-2" id="username">Chargement...</h1>
                    <p class="text-slate-400 flex items-center justify-center md:justify-start gap-2">
                        üìß <span id="email">...</span>
                    </p>
                    <div class="mt-4">
                        <span id="roleBadge"
                            class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-slate-700 text-slate-300">
                            ...
                        </span>
                    </div>
                </div>
            </div>

            <div
                class="mt-8 pt-8 border-t border-slate-700 grid grid-cols-1 md:grid-cols-2 gap-4 text-center md:text-left">
                <div>
                    <p class="text-xs text-slate-500 uppercase font-bold mb-1">ID Joueur</p>
                    <p class="text-white font-mono" id="userId">#</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const token = localStorage.getItem('token');

            if (!token) {
                window.location.href = '/login';
                return;
            }

            try {
                // Appel √† l'API pour r√©cup√©rer les infos fra√Æches
                const res = await fetch('/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) throw new Error("Non autoris√©");

                const result = await res.json();
                const user = result.data || result; // Selon si ton controller renvoie {data: user} ou juste user

                // Remplissage du DOM
                document.getElementById('username').innerText = user.username;
                document.getElementById('email').innerText = user.email;
                document.getElementById('userId').innerText = `#${user.id}`;

                // Avatar (Premi√®re lettre)
                document.getElementById('avatar').innerText = user.username.charAt(0).toUpperCase();

                // R√¥le (Couleur dynamique)
                const roleBadge = document.getElementById('roleBadge');
                roleBadge.innerText = user.role;

                if (user.role === 'ADMIN') {
                    roleBadge.className = "px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-red-900 text-red-200 border border-red-700";
                } else if (user.role === 'ORGANIZER') {
                    roleBadge.className = "px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-purple-900 text-purple-200 border border-purple-700";
                } else {
                    roleBadge.className = "px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide bg-blue-900 text-blue-200 border border-blue-700";
                }

            } catch (err) {
                console.error(err);
                localStorage.removeItem('token');
                window.location.href = '/login';
            }
        });
    </script>

    <%- include('../partials/footer') %>