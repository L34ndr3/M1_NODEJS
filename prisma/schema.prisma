// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// --- MODÃˆLES E-SPORT ---

enum UserRole {
  PLAYER
  ORGANIZER
  ADMIN
}

enum TournamentFormat {
  SOLO
  TEAM
}

enum TournamentStatus {
  DRAFT
  OPEN
  ONGOING
  COMPLETED
  CANCELLED
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  REJECTED
  WITHDRAWN
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String
  role      UserRole @default(PLAYER)
  
  teamId         Int?
  team           Team? @relation(fields: [teamId], references: [id])
  organizedTournaments Tournament[] 
  captainOf      Team[] @relation("TeamCaptain")
  registrations  Registration[] @relation("PlayerRegistration")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tournament {
  id              Int      @id @default(autoincrement())
  name            String
  game            String
  format          TournamentFormat
  maxParticipants Int
  prizePool       Float?
  startDate       DateTime
  endDate         DateTime?
  status          TournamentStatus @default(DRAFT)

  organizerId   Int
  organizer     User @relation(fields: [organizerId], references: [id])
  registrations Registration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Team {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  tag       String   @unique
  captainId Int
  captain   User     @relation("TeamCaptain", fields: [captainId], references: [id])
  
  members       User[]
  registrations Registration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Registration {
  id           Int      @id @default(autoincrement())
  tournamentId Int
  tournament   Tournament @relation(fields: [tournamentId], references: [id])
  
  playerId     Int?
  player       User? @relation("PlayerRegistration", fields: [playerId], references: [id])
  
  teamId       Int?
  team         Team? @relation(fields: [teamId], references: [id])
  
  status       RegistrationStatus @default(PENDING)
  
  registeredAt DateTime @default(now())
  confirmedAt  DateTime?
}